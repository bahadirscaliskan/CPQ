<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kademe BazlÄ± Teklif Sistemi</title>
    <style>
        :root {
            --primary: #203764;
            --secondary: #4472c4;
            --active-text: #0f5132;
            --active-bg: #d1e7dd;
            --bg: #f4f6f9;
            --dark-footer: #343a40;
            --extra-color: #6f42c1;
            --master-color: #f0ad4e;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            font-size: 13px;
            color: #333;
        }

        /* --- SOL PANEL --- */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.03);
            z-index: 10;
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 18px;
            text-align: center;
            font-weight: 700;
            font-size: 1.2em;
        }

        .scroll-y { overflow-y: auto; flex: 1; padding-bottom: 20px; }

        .group-title {
            background: #e9ecef;
            color: #495057;
            padding: 10px 20px;
            font-weight: 800;
            font-size: 0.85em;
            text-transform: uppercase;
            border-bottom: 1px solid #dee2e6;
            margin-top: 10px;
        }

        .input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 20px;
            border-bottom: 1px solid #f1f3f5;
            transition: background 0.2s;
        }
        .input-row:hover { background: #f8f9fa; }
        
        .qty-input {
            width: 60px;
            padding: 6px;
            text-align: center;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1em;
        }

        .group-total-row {
            background: #f1f5f9;
            color: var(--primary);
            padding: 6px 20px;
            font-weight: bold;
            font-size: 0.9em;
            text-align: right;
            border-bottom: 1px solid #dee2e6;
        }

        .summary-box {
            padding: 20px;
            background: var(--dark-footer);
            color: white;
            text-align: center;
            border-top: 1px solid #4b545c;
            height: 110px; box-sizing: border-box;
            display: flex; flex-direction: column; justify-content: center;
        }

        /* --- SAÄ PANEL --- */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            overflow: hidden;
        }

        .top-bar {
            padding: 15px 30px;
            background: #fff;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .platform-info {
            background: #e3f2fd; color: #0d47a1; padding: 8px 15px; border-radius: 6px; font-weight: bold; border: 1px solid #bbdefb;
        }

        .content {
            flex: 1; padding: 30px; overflow: auto; background: #f4f6f9;
        }

        .card {
            background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.04); margin-bottom: 30px; overflow: hidden; border: 1px solid #e0e0e0;
            display: flex; flex-direction: column;
        }

        .card-header {
            background: var(--primary); color: white; padding: 12px 20px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; font-size: 1.1em;
        }
        
        .header-extra { background: var(--extra-color) !important; }
        .header-master-plus { background: var(--master-color) !important; color: white !important; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }

        .btn-add {
            background: #28a745; color: white; border: none; padding: 5px 12px; border-radius: 4px; font-size: 0.8em; cursor: pointer; font-weight: bold;
        }

        table { width: 100%; border-collapse: collapse; text-align: center; }
        
        th {
            background: #f8f9fa; color: #555; padding: 12px 8px; font-size: 0.85em; border: 1px solid #dee2e6; vertical-align: middle; font-weight: 700;
        }

        td {
            padding: 8px 8px; border: 1px solid #f1f1f1; vertical-align: middle;
        }

        .ref-price {
            background: #fff; color: #333; font-family: 'Consolas', monospace; font-weight: bold; border: 2px solid #ddd; border-radius: 4px; width: 90%; text-align: right; padding: 6px;
        }

        .calc-cell {
            font-family: 'Consolas', monospace; text-align: right; color: #888; font-size: 0.95em; padding-right: 10px; transition: 0.3s;
        }
        
        .active-cell {
            color: var(--active-text) !important;
            font-weight: 900 !important;
            font-size: 1.15em !important;
            background-color: var(--active-bg);
            border-radius: 4px;
            padding: 5px;
        }

        .level-select {
            padding: 5px; border-radius: 4px; border: 1px solid #ccc; font-size: 0.9em; width: 100%; color: var(--primary); font-weight: 600;
        }

        .custom-col { background-color: #fff0f0; border-left: 2px solid #dc3545; }
        .custom-input { width: 42%; padding: 5px; border: 1px solid #e0e0e0; border-radius: 3px; text-align: center; font-weight: bold; font-size: 0.9em; }
        
        .inp-flat { border: none; width: 100%; text-align: left; font-weight: 600; color: #333; }
        .row-total { font-weight: 800; text-align: right; padding-right: 15px; font-size: 1.1em; color: var(--primary); font-family: 'Consolas', monospace;}
        
        .multiplier-badge { display: inline-block; background: #e2e8f0; color: #475569; font-size: 0.75em; border-radius: 12px; padding: 2px 8px; margin-top: 4px; font-weight: normal; }

        .card-footer-summary { background: #fafbfc; border-top: 1px solid #dee2e6; padding: 15px 20px; display: flex; justify-content: flex-end; gap: 40px; }
        .card-stat { text-align: right; border-left: 3px solid var(--secondary); padding-left: 15px; }
        .card-stat small { display: block; font-size: 0.75em; color: #888; text-transform: uppercase; font-weight:bold; }
        .card-stat span { display: block; font-size: 1.2em; color: #333; font-weight: 800; font-family: 'Consolas', monospace;}

        /* FOOTER */
        .footer {
            background: var(--dark-footer); border-top: 1px solid #4b545c; padding: 20px 40px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; z-index: 20; height: 110px; box-sizing: border-box; align-items: center;
        }
        .kpi { 
            text-align: center; padding: 10px; border-radius: 8px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.1); color: white; height: 100%; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center;
        }
        .kpi small { display: block; font-size: 0.7em; color: #ced4da; text-transform: uppercase; font-weight: 700; margin-bottom: 5px;}
        .kpi div { font-size: 1.4em; font-weight: 800; color: #fff; }
        .highlight { background: rgba(255, 193, 7, 0.15); border-color: rgba(255, 193, 7, 0.3); }
        .highlight div { color: #ffc107; }
        .highlight-extra { background: rgba(111, 66, 193, 0.25); border-color: rgba(111, 66, 193, 0.4); }
        .highlight-extra div { color: #d6b3ff; }

        .drag-handle { cursor: grab; color: #aaa; font-size: 1.2em; width: 30px; user-select: none; }
        .dragging { opacity: 0.5; background-color: #f0f0f0; border: 2px dashed #999; }
        
        .price-input { width: 85%; text-align: right; border: 1px solid #e0e0e0; padding: 6px; border-radius: 4px; color: #333; background: white; font-family: 'Consolas', monospace; }
        .row-disabled { opacity: 0.4; background-color: #f9f9f9; }
        .row-select { width: 18px; height: 18px; cursor: pointer; }
        .del-cell { color: #dc3545; cursor: pointer; font-weight: bold; font-size: 1.2em; text-align: center; }

    </style>
</head>
<body>

<div class="sidebar">
    <div class="header">Ã–ÄRENCÄ° GÄ°RÄ°ÅÄ°</div>
    
    <div class="scroll-y">
        <div class="group-title">OKUL Ã–NCESÄ°</div>
        <div class="input-row"><label>0. SÄ±nÄ±f</label><input type="number" id="s0" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="group-total-row">Toplam: <span id="sub_pre">0</span></div>

        <div class="group-title">Ä°LKOKUL (1-4)</div>
        <div class="input-row"><label>1. SÄ±nÄ±f</label><input type="number" id="s1" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>2. SÄ±nÄ±f</label><input type="number" id="s2" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>3. SÄ±nÄ±f</label><input type="number" id="s3" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>4. SÄ±nÄ±f</label><input type="number" id="s4" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="group-total-row">Ä°lkokul Toplam: <span id="sub_primary">0</span></div>

        <div class="group-title">ORTAOKUL (5-8)</div>
        <div class="input-row"><label>5. SÄ±nÄ±f</label><input type="number" id="s5" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>6. SÄ±nÄ±f</label><input type="number" id="s6" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>7. SÄ±nÄ±f</label><input type="number" id="s7" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>8. SÄ±nÄ±f</label><input type="number" id="s8" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="group-total-row">Ortaokul Toplam: <span id="sub_middle">0</span></div>

        <div class="group-title">LÄ°SE (9-12)</div>
        <div class="input-row"><label>9. SÄ±nÄ±f</label><input type="number" id="s9" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>10. SÄ±nÄ±f</label><input type="number" id="s10" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>11. SÄ±nÄ±f</label><input type="number" id="s11" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="input-row"><label>12. SÄ±nÄ±f</label><input type="number" id="s12" class="qty-input" value="0" min="0" oninput="calculateAll()"></div>
        <div class="group-total-row">Lise Toplam: <span id="sub_high">0</span></div>
    </div>

    <div class="summary-box">
        <small style="opacity:0.7; letter-spacing:1px; color:#ced4da;">TOPLAM Ã–ÄRENCÄ°</small>
        <div style="font-size:2.5em; font-weight:bold; margin-top:5px; color:#fff;" id="lblTotalStudents">0</div>
        <div style="color:#ffc107; margin-top:5px; font-weight:bold; font-size:0.9em;" id="lblRangeInfo">SeÃ§im Yok</div>
    </div>
</div>

<div class="main">
    <div class="top-bar">
        <div class="platform-info">
            â„¹ï¸ Paket Bilgileri: <strong>TeknoPaket (399 â‚º)</strong> | <strong>MasterPaket (1050 â‚º)</strong>
        </div>
        <div style="color:#666; font-size:0.9em; text-align:right; display:flex; align-items:center; gap:20px;">
            <div>
                <div>* â˜° Ä°konundan tutarak sÄ±ralamayÄ± deÄŸiÅŸtirebilirsiniz.</div>
            </div>
            <button onclick="resetData()" style="background:#dc3545; color:white; border:none; padding:8px 12px; border-radius:4px; cursor:pointer; font-weight:bold;">
                ğŸ—‘ SÄ±fÄ±rla (VarsayÄ±lan)
            </button>
        </div>
    </div>

    <div class="content">
        
        <div class="card">
            <div class="card-header">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span>ğŸ›  LAB MALZEME SEÃ‡Ä°MÄ°</span>
                    <button class="btn-add" onclick="addNewRow('materials')">+ Ekle</button>
                </div>
                <small style="font-weight:normal; opacity:0.9;">Fiyat x Ã‡arpan (Kademeye GÃ¶re)</small>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="30"></th>
                        <th width="30">SeÃ§</th>
                        <th width="15%" style="text-align:left; padding-left:10px;">MALZEME ADI</th>
                        <th width="10%">HEDEF KADEME</th>
                        <th width="10%">REF. BÄ°RÄ°M FÄ°YAT</th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (4/1) 1-250<br><span class="multiplier-badge">x6 Adet</span></th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (4/2) 251-500<br><span class="multiplier-badge">x12 Adet</span></th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (4/3) 501-1000<br><span class="multiplier-badge">x18 Adet</span></th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (4/4) 1000+<br><span class="multiplier-badge">x24 Adet</span></th>
                        <th class="custom-col" width="10%">Ã–ZEL<br><small>Adet & Fiyat</small></th>
                        <th width="10%">TOPLAM</th>
                        <th width="30"></th>
                    </tr>
                </thead>
                <tbody id="bodyMaterials" class="sortable-list"></tbody>
            </table>
            <div class="card-footer-summary">
                <div class="card-stat"><small>Bu BÃ¶lÃ¼m ToplamÄ±</small><span id="sum_materials">0 â‚º</span></div>
                <div class="card-stat" style="border-left-color: #28a745;"><small>Ã–ÄŸrenci BaÅŸÄ± Ort.</small><span id="avg_materials">0 â‚º</span></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span>ğŸ”¬ LAB PROJE SEÃ‡Ä°MÄ°</span>
                    <button class="btn-add" onclick="addNewRow('projects')">+ Ekle</button>
                </div>
                <small style="font-weight:normal; opacity:0.9;">Maksimum 6 Adet SeÃ§ilebilir</small>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="30"></th>
                        <th width="30">SeÃ§</th>
                        <th width="15%" style="text-align:left; padding-left:10px;">PROJE ADI</th>
                        <th width="10%">HEDEF KADEME</th>
                        <th width="10%">REF. BÄ°RÄ°M FÄ°YAT</th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (18) 1-250<br><span class="multiplier-badge">x3 Adet</span></th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (36) 251-500<br><span class="multiplier-badge">x6 Adet</span></th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (54) 501-1000<br><span class="multiplier-badge">x9 Adet</span></th>
                        <th class="col-range">Lab DaÄŸalÄ±mÄ± (72) 1000+<br><span class="multiplier-badge">x12 Adet</span></th>
                        <th class="custom-col" width="10%">Ã–ZEL<br><small>Adet & Fiyat</small></th>
                        <th width="10%">TOPLAM</th>
                        <th width="30"></th>
                    </tr>
                </thead>
                <tbody id="bodyProjects" class="sortable-list"></tbody>
            </table>
            <div class="card-footer-summary">
                <div class="card-stat"><small>Bu BÃ¶lÃ¼m ToplamÄ±</small><span id="sum_projects">0 â‚º</span></div>
                <div class="card-stat" style="border-left-color: #28a745;"><small>Ã–ÄŸrenci BaÅŸÄ± Ort.</small><span id="avg_projects">0 â‚º</span></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span>ğŸ“¦ BÄ°REYSEL MALZEME</span>
                    <button class="btn-add" onclick="addNewRow('individual')">+ Ekle</button>
                </div>
                <small style="font-weight:normal; opacity:0.9;">KÄ±sÄ±tlama: 1-2. SÄ±nÄ±f (Max 4), 3-4. SÄ±nÄ±f (Max 3)</small>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="30"></th>
                        <th width="30">SeÃ§</th>
                        <th width="40%" style="text-align:left; padding-left:15px;">ÃœRÃœN ADI</th>
                        <th width="15%">BÄ°RÄ°M FÄ°YAT</th>
                        <th width="20%">TOPLAM TUTAR</th>
                        <th width="30"></th>
                    </tr>
                </thead>
                <tbody id="bodyIndividual" class="sortable-list"></tbody>
            </table>
            <div class="card-footer-summary">
                <div class="card-stat"><small>Bu BÃ¶lÃ¼m ToplamÄ±</small><span id="sum_individual">0 â‚º</span></div>
                <div class="card-stat" style="border-left-color: #28a745;"><small>Ã–ÄŸrenci BaÅŸÄ± Ort.</small><span id="avg_individual">0 â‚º</span></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header header-extra">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span>ğŸ§ª DENEY SETLERÄ° SEÃ‡Ä°MÄ°</span>
                    <button class="btn-add" onclick="addNewRow('experimentSets')">+ Ekle</button>
                </div>
                <small style="font-weight:normal; opacity:0.9;">Fiyat x Adet (Ana Ortalamaya KatÄ±lmaz)</small>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="30"></th>
                        <th width="30">SeÃ§</th>
                        <th width="40%" style="text-align:left; padding-left:15px;">ÃœRÃœN ADI</th>
                        <th width="15%">BÄ°RÄ°M FÄ°YAT</th>
                        <th width="15%">ADET</th>
                        <th width="20%">TOPLAM TUTAR</th>
                        <th width="30"></th>
                    </tr>
                </thead>
                <tbody id="bodyExperimentSets" class="sortable-list"></tbody>
            </table>
            <div class="card-footer-summary">
                <div class="card-stat" style="border-left-color: var(--extra-color);"><small>Setler ToplamÄ±</small><span id="sum_experiments">0 â‚º</span></div>
                <div class="card-stat" style="border-left-color: #28a745;"><small>Ortalama (Adet BaÅŸÄ±)</small><span id="avg_experiments">0 â‚º</span></div>
            </div>
        </div>

        <div class="card">
            <div class="card-header header-extra">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span>ğŸ§¸ OKUL Ã–NCESÄ° YAYIN KUTULARI</span>
                    <button class="btn-add" onclick="addNewRow('preschoolBoxes')">+ Ekle</button>
                </div>
                <small style="font-weight:normal; opacity:0.9;">Adet Manuel Girilir (Ana Ortalamaya KatÄ±lmaz)</small>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="30"></th>
                        <th width="30">SeÃ§</th>
                        <th width="40%" style="text-align:left; padding-left:15px;">ÃœRÃœN ADI</th>
                        <th width="15%">BÄ°RÄ°M FÄ°YAT</th>
                        <th width="15%">ADET (Manuel)</th>
                        <th width="20%">TOPLAM TUTAR</th>
                        <th width="30"></th>
                    </tr>
                </thead>
                <tbody id="bodyPreschoolBoxes" class="sortable-list"></tbody>
            </table>
            <div class="card-footer-summary">
                <div class="card-stat" style="border-left-color: var(--extra-color);"><small>Kutular ToplamÄ±</small><span id="sum_preschool">0 â‚º</span></div>
                <div class="card-stat" style="border-left-color: #28a745;"><small>Ortalama (Adet BaÅŸÄ±)</small><span id="avg_preschool">0 â‚º</span></div>
            </div>
        </div>

        <div class="card" style="border: 2px solid var(--master-color);">
            <div class="card-header header-master-plus">
                <div style="display:flex; align-items:center; gap:10px;">
                    <span>ğŸ’ PLUS HÄ°ZMET PAKETÄ° (SADECE MASTER)</span>
                    <button class="btn-add" style="background:#856404;" onclick="addNewRow('plusServices')">+ Ekle</button>
                </div>
                <small style="font-weight:normal; opacity:1;">Sadece Master Paket'e Eklenir | Adet = Toplam Ã–ÄŸrenci SayÄ±sÄ±</small>
            </div>
            <table>
                <thead>
                    <tr>
                        <th width="30"></th>
                        <th width="30">SeÃ§</th>
                        <th width="40%" style="text-align:left; padding-left:15px;">HÄ°ZMET ADI</th>
                        <th width="15%">Ã–ÄR. BAÅI FÄ°YAT</th>
                        <th width="15%">TOPLAM ADET (Oto)</th>
                        <th width="20%">TOPLAM TUTAR</th>
                        <th width="30"></th>
                    </tr>
                </thead>
                <tbody id="bodyPlusServices" class="sortable-list"></tbody>
            </table>
            <div class="card-footer-summary" style="background-color: #fff3cd;">
                <div class="card-stat" style="border-left-color: var(--master-color);"><small>Plus Hizmet ToplamÄ±</small><span id="sum_plus">0 â‚º</span></div>
                <div class="card-stat" style="border-left-color: #28a745;"><small>Ortalama (Ã–ÄŸr. BaÅŸÄ±)</small><span id="avg_plus">0 â‚º</span></div>
            </div>
        </div>

    </div>

    <div class="footer">
        <div class="kpi">
            <small>TOPLAM MALZEME GÄ°DERÄ°</small>
            <div id="valMaterial">0 â‚º</div>
        </div>
        <div class="kpi highlight">
            <small>MALÄ°YET + TEKNOPAKET (Ã–ÄŸr. BaÅŸÄ±)</small>
            <div id="valTekno">0 â‚º</div>
        </div>
        <div class="kpi highlight">
            <small>MALÄ°YET + MASTERPAKET (Ã–ÄŸr. BaÅŸÄ±)</small>
            <div id="valMaster">0 â‚º</div>
        </div>
        <div class="kpi highlight-extra">
            <small>EKSTRA SET & YAYIN TOPLAMI</small>
            <div id="valExtraTotal">0 â‚º</div>
        </div> 
    </div>
</div>

<script>
    // --- YAZILIM GELÄ°ÅTÄ°RÄ°CÄ° Ä°MZASI (SÄ°LÄ°NEMEZ/DEÄÄ°ÅTÄ°RÄ°LEMEZ) ---
    (function() {
        const DEVELOPER_INFO = Object.freeze({
            name: "BahadÄ±r Ã‡alÄ±ÅŸkan", 
            contact: "YazÄ±lÄ±m GeliÅŸtirici", 
            version: "v1.0",
            copyright: "Â© 2025 BahadÄ±r Ã‡alÄ±ÅŸkan - TÃ¼m HaklarÄ± SaklÄ±dÄ±r",
            message: "Bu yazÄ±lÄ±m mimarisi ve kod yapÄ±sÄ± BahadÄ±r Ã‡alÄ±ÅŸkan tarafÄ±ndan tasarlanmÄ±ÅŸtÄ±r."
        });

        Object.defineProperty(window, 'SYS_AUTHOR', {
            value: DEVELOPER_INFO,
            writable: false,     
            configurable: false, 
            enumerable: true     
        });

        console.log(
            "%c ğŸ›‘ GeliÅŸtirici Ä°mzasÄ±: " + DEVELOPER_INFO.name + " ",
            "background: #b91c1c; color: #ffffff; font-size: 16px; font-weight: bold; padding: 10px; border-radius: 5px;"
        );
        console.log(
            "%c Bu proje " + DEVELOPER_INFO.name + " tarafÄ±ndan kodlanmÄ±ÅŸtÄ±r. " +
            "Ä°zinsiz kopyalanmasÄ± veya kaynak gÃ¶sterilmeden kullanÄ±lmasÄ± yasaktÄ±r.\n" + 
            "Versiyon: " + DEVELOPER_INFO.version,
            "background: #203764; color: #ffffff; font-size: 12px; padding: 5px; border-radius: 4px;"
        );
    })();
    // -----------------------------------------------------------

    const configProjects = { multipliers: [3, 6, 9, 12] };
    const configMaterials = { multipliers: [6, 12, 18, 24] };

    // --- VERÄ° TABANLARI ---

    const dbProjects = [
        { name: "AKILLI ARABA", price: 0, level: 'all' },
        { name: "HACÄ°M Ã–LÃ‡ER", price: 0, level: 'all' },
        { name: "DÄ°NAMOMETRE", price: 0, level: 'all' },
        { name: "AKILLI KUÅ EVÄ°", price: 0, level: 'all' },
        { name: "MÃœCEVHER KORUMA", price: 0, level: 'all' },
        { name: "AKILLI KUMBARA", price: 0, level: 'all' },
        { name: "AKILLI EV", price: 0, level: 'all' },
        { name: "AKILLI SERA", price: 0, level: 'all' }
    ];

    const dbMaterials = [
        { name: "TURP", price: 0, level: 'pre' }, 
        { name: "KÃœMÃœLÃœS", price: 0, level: 'pri' }, 
        { name: "KIRMIZI KUTU", price: 0, level: 'mid' },
        { name: "SÄ°YAH KUTU", price: 0, level: 'high' },
        { name: "Micro:Bit", price: 0, level: 'pri' },
        { name: "Raspberry Pi", price: 0, level: 'high' },
        { name: "Bee-Bot", price: 0, level: 'pre' },
        { name: "Cubetto Robot", price: 0, level: 'pre' },
        { name: "Mbot Robot", price: 0, level: 'mid' },
        { name: "3B YazÄ±cÄ± Filament", price: 500, level : 'all' }
    ];

    const dbIndividual = [
        // 1. SÄ±nÄ±f
        { name: "1.SINIF Fungrid Kodlama KitabÄ±", price: 0, targetClass: "s1" },
        { name: "1.SINIF Telefon YapalÄ±m", price: 0, targetClass: "s1" },
        { name: "1.SINIF Helikopter YapalÄ±m", price: 0, targetClass: "s1" },
        { name: "1.SINIF Ã–rÃ¼mcek YapalÄ±m", price: 0, targetClass: "s1" },
        { name: "1.SINIF Kelebekler ve ArÄ±lar", price: 0, targetClass: "s1" },
        { name: "1.SINIF Ä°zlerimi Takip Et", price: 0, targetClass: "s1" },

        // 2. SÄ±nÄ±f
        { name: "2.SINIF Fungrid Kodlama KitabÄ±", price: 0, targetClass: "s2" },
        { name: "2.SINIF Radyo YapalÄ±m", price: 0, targetClass: "s2" },
        { name: "2.SINIF Uzay Uydusu YapalÄ±m", price: 0, targetClass: "s2" },
        { name: "2.SINIF UÃ§ak YapalÄ±m", price: 0, targetClass: "s2" },
        { name: "2.SINIF Saat KaÃ§?", price: 0, targetClass: "s2" },

        // 3. SÄ±nÄ±f
        { name: "3.SINIF Elektrik SÃ¼pÃ¼rgesi", price: 0, targetClass: "s3" },
        { name: "3.SINIF Trafik LambasÄ±", price: 0, targetClass: "s3" },
        { name: "3.SINIF RÃ¼zgar TÃ¼rbini", price: 0, targetClass: "s3" },
        { name: "3.SINIF Meslekler", price: 0, targetClass: "s3" },
        { name: "3.SINIF Origamik kÄ±yafetlerim Meslekler", price: 0, targetClass: "s3" },

        // 4. SÄ±nÄ±f
        { name: "4.SINIF Mors Kod", price: 0, targetClass: "s4" },
        { name: "4.SINIF AsansÃ¶r Projesi", price: 0, targetClass: "s4" },
        { name: "4.SINIF YÃ¼zÃ¼k Projesi", price: 0, targetClass: "s4" },
        { name: "4.SINIF AyÄ±n Evreleri", price: 0, targetClass: "s4" },
        { name: "4.SINIF Geri DÃ¶nÃ¼ÅŸÃ¼m", price: 0, targetClass: "s4" }
    ];

    // Yeni Veri Setleri
    const dbExperiments = [
        { name: "Okul Ã–ncesi - 1.Su mikroskobu", price: 0 },
        { name: "Okul Ã–ncesi - 2.Tekerlek YapalÄ±m", price: 0 },
        { name: "Okul Ã–ncesi - 3.Kitap BaskÄ±sÄ± YapalÄ±m", price: 0 },
        { name: "Okul Ã–ncesi - 4.KÄ±rÄ±lmayan Ayna", price: 0 },
        { name: "Okul Ã–ncesi - 5.YusufÃ§uk", price: 0 },
        { name: "Okul Ã–ncesi - 6.Yunus BalÄ±ÄŸÄ±", price: 0 },
        { name: "Okul Ã–ncesi - 7.Newton Ã‡arkÄ±", price: 0 },
        { name: "Okul Ã–ncesi - 8.OyuncaÄŸÄ±m TopaÃ§", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 1.GÃ¶zlÃ¼k YapalÄ±m", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 2.Pusula YapalÄ±m", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 3.ParaÅŸÃ¼t YapalÄ±m", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 4.Teleskop YapalÄ±m", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 5.Su DeÄŸirmeni YapalÄ±m", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 6.Yarasalar 2", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 7.NeptÃ¼n'Ã¼ KeÅŸfet", price: 0 },
        { name: "1-2.SÄ±nÄ±f - 8.NasÄ±l Daha HÄ±zlÄ± YÃ¼zÃ¼lebilir", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 1.AsansÃ¶r YapalÄ±m", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 2.Vida YapalÄ±m", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 3.Kaleydeskop YapalÄ±m", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 4.MÄ±knatÄ±s ile Labirent YapalÄ±m", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 5.Kum Saati YapalÄ±m", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 6.KÃ¢ÄŸÄ±t YapalÄ±m", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 7.YalÄ±Ã§apkÄ±nÄ± KuÅŸu", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 8.Sera YapalÄ±m", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 9.Robot SÃ¼pÃ¼rge Meslekler", price: 0 },
        { name: "3-4.SÄ±nÄ±f - 10.Quiling SanatÄ±", price: 0 }
    ];

    const dbPreschool = [
        { name: "Okul Ã–ncesi 48-60 Ay Ã–ÄŸrenci Kutusu", price: 0 },
        { name: "Okul Ã–ncesi 60-72 Ay Ã–ÄŸrenci Kutusu", price: 0 }
    ];

    const dbPlusServices = [
        { name: "Master Paket Ã–zel Ek Hizmet", price: 0 }
    ];

    let counts = {}; 
    const STORAGE_KEY = 'teklifSistemiV26_Data'; // v26

    window.onload = function() {
        if(!loadFromLocal()) {
            renderTables();
        }
        calculateAll(true);
        initDragAndDrop();
    };

    // --- LOCAL STORAGE ---
    function saveToLocal() {
        const studentInputs = {};
        for(let i=0; i<=12; i++) {
            let id = 's' + i;
            studentInputs[id] = document.getElementById(id).value;
        }

        const materials = scrapeTableData('bodyMaterials', 'materials');
        const projects = scrapeTableData('bodyProjects', 'projects');
        const individual = scrapeIndividualData();
        const experimentSets = scrapeSimpleData('bodyExperimentSets');
        const preschoolBoxes = scrapeSimpleData('bodyPreschoolBoxes');
        const plusServices = scrapeSimpleData('bodyPlusServices');

        const data = {
            students: studentInputs,
            materials: materials,
            projects: projects,
            individual: individual,
            experimentSets: experimentSets,
            preschoolBoxes: preschoolBoxes,
            plusServices: plusServices
        };

        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function scrapeTableData(tbodyId, type) {
        let rows = [];
        document.querySelectorAll(`#${tbodyId} tr`).forEach(row => {
            let prefix = type === 'projects' ? 'p' : 'm';
            rows.push({
                name: row.querySelector('.inp-flat').value,
                checked: row.querySelector('.row-select').checked,
                level: row.querySelector('.level-select').value,
                price: row.querySelector('.ref-price').value,
                custQty: row.querySelector(`.${prefix}-cust-qty`).value,
                custPrice: row.querySelector(`.${prefix}-cust-price`).value
            });
        });
        return rows;
    }

    function scrapeIndividualData() {
        let rows = [];
        document.querySelectorAll('#bodyIndividual tr').forEach(row => {
            rows.push({
                name: row.querySelector('.inp-flat').value,
                checked: row.querySelector('.row-select').checked,
                price: row.querySelector('.ind-price').value,
                target: row.getAttribute('data-target')
            });
        });
        return rows;
    }

    function scrapeSimpleData(tbodyId) {
        let rows = [];
        document.querySelectorAll(`#${tbodyId} tr`).forEach(row => {
            rows.push({
                name: row.querySelector('.inp-flat').value,
                checked: row.querySelector('.row-select').checked,
                price: row.querySelector('.simple-price').value,
                qty: row.querySelector('.simple-qty').value
            });
        });
        return rows;
    }

    function loadFromLocal() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return false;

        try {
            const data = JSON.parse(raw);
            
            if(data.students) {
                for(let key in data.students) {
                    let el = document.getElementById(key);
                    if(el) el.value = data.students[key];
                }
            }

            document.getElementById('bodyMaterials').innerHTML = '';
            document.getElementById('bodyProjects').innerHTML = '';
            document.getElementById('bodyIndividual').innerHTML = '';
            document.getElementById('bodyExperimentSets').innerHTML = '';
            document.getElementById('bodyPreschoolBoxes').innerHTML = '';
            document.getElementById('bodyPlusServices').innerHTML = '';

            if(data.projects) {
                const tb = document.getElementById('bodyProjects');
                data.projects.forEach(item => {
                    tb.insertAdjacentHTML('beforeend', createMatrixRow('projects', item.name, item.price, item.level, item.checked));
                    let lastRow = tb.lastElementChild;
                    lastRow.querySelector('.p-cust-qty').value = item.custQty;
                    lastRow.querySelector('.p-cust-price').value = item.custPrice;
                });
            }

            if(data.materials) {
                const tb = document.getElementById('bodyMaterials');
                data.materials.forEach(item => {
                    tb.insertAdjacentHTML('beforeend', createMatrixRow('materials', item.name, item.price, item.level, item.checked));
                    let lastRow = tb.lastElementChild;
                    lastRow.querySelector('.m-cust-qty').value = item.custQty;
                    lastRow.querySelector('.m-cust-price').value = item.custPrice;
                });
            }

            if(data.individual) {
                const tb = document.getElementById('bodyIndividual');
                data.individual.forEach(item => {
                    tb.insertAdjacentHTML('beforeend', createIndividualRow(item.name, item.price, item.target, 0, item.checked));
                });
            }

            if(data.experimentSets) {
                const tb = document.getElementById('bodyExperimentSets');
                data.experimentSets.forEach(item => {
                    tb.insertAdjacentHTML('beforeend', createSimpleRow('experimentSets', item.name, item.price, item.qty, item.checked));
                });
            }

            if(data.preschoolBoxes) {
                const tb = document.getElementById('bodyPreschoolBoxes');
                data.preschoolBoxes.forEach(item => {
                    tb.insertAdjacentHTML('beforeend', createSimpleRow('preschoolBoxes', item.name, item.price, item.qty, item.checked));
                });
            }

            if(data.plusServices) {
                const tb = document.getElementById('bodyPlusServices');
                data.plusServices.forEach(item => {
                    tb.insertAdjacentHTML('beforeend', createSimpleRow('plusServices', item.name, item.price, item.qty, item.checked));
                });
            }

            return true;
        } catch(e) {
            console.error("Save dosyasÄ± okunamadÄ±", e);
            return false;
        }
    }

    function resetData() {
        if(confirm('TÃ¼m veriler silinecek ve varsayÄ±lan ayarlara dÃ¶nÃ¼lecek. OnaylÄ±yor musunuz?')) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }

    function renderTables() {
        const tbProj = document.getElementById("bodyProjects");
        dbProjects.forEach((p, index) => {
            tbProj.insertAdjacentHTML('beforeend', createMatrixRow('projects', p.name, p.price, p.level, index === 0));
        });
        const tbMat = document.getElementById("bodyMaterials");
        dbMaterials.forEach((m, index) => {
            tbMat.insertAdjacentHTML('beforeend', createMatrixRow('materials', m.name, m.price, m.level, index === 0));
        });
        const tbInd = document.getElementById("bodyIndividual");
        dbIndividual.forEach((i, index) => {
            tbInd.insertAdjacentHTML('beforeend', createIndividualRow(i.name, i.price, i.targetClass, 0, index === 0));
        });
        const tbExp = document.getElementById("bodyExperimentSets");
        dbExperiments.forEach((e, index) => {
            // VarsayÄ±lan Adet 0 yapÄ±ldÄ±
            tbExp.insertAdjacentHTML('beforeend', createSimpleRow('experimentSets', e.name, e.price, 0, index < 5));
        });
        const tbPre = document.getElementById("bodyPreschoolBoxes");
        dbPreschool.forEach((p, index) => {
            // VarsayÄ±lan Adet 0 ve Manuel GiriÅŸ
            tbPre.insertAdjacentHTML('beforeend', createSimpleRow('preschoolBoxes', p.name, p.price, 0, index === 0));
        });
        const tbPlus = document.getElementById("bodyPlusServices");
        dbPlusServices.forEach((p, index) => {
            tbPlus.insertAdjacentHTML('beforeend', createSimpleRow('plusServices', p.name, p.price, 0, false));
        });
    }

    function createMatrixRow(type, name, refPrice, level, isChecked) {
        let prefix = type === 'projects' ? 'p' : 'm';
        let clsTot = type === 'projects' ? 'proj-total' : 'mat-total';
        let multipliers = type === 'projects' ? configProjects.multipliers : configMaterials.multipliers;
        
        refPrice = parseFloat(refPrice);
        let v0 = refPrice * multipliers[0], v1 = refPrice * multipliers[1], v2 = refPrice * multipliers[2], v3 = refPrice * multipliers[3];
        let checkAttr = isChecked ? 'checked' : '';
        let lvlOpts = `<option value="all">TÃ¼m Okul</option><option value="pre">Okul Ã–ncesi</option><option value="pri">Ä°lkokul</option><option value="mid">Ortaokul</option><option value="high">Lise</option>`;
        if(level) lvlOpts = lvlOpts.replace(`value="${level}"`, `value="${level}" selected`);

        return `<tr draggable="true" data-type="${type}" data-level="${level || 'all'}">
            <td class="drag-handle">â˜°</td>
            <td><input type="checkbox" class="row-select" ${checkAttr} onchange="handleCheck(this, '${type}')"></td>
            <td><input class="inp-flat" value="${name}" placeholder="ÃœrÃ¼n AdÄ±" oninput="saveToLocal()"></td>
            <td><select class="level-select" onchange="updateRowLevel(this)">${lvlOpts}</select></td>
            <td><input type="number" min="0" class="ref-price" value="${refPrice}" oninput="updateRowPrices(this, '${type}')"></td>
            <td><div class="calc-cell ${prefix}-cell-0">${fmtSimple(v0)}</div></td>
            <td><div class="calc-cell ${prefix}-cell-1">${fmtSimple(v1)}</div></td>
            <td><div class="calc-cell ${prefix}-cell-2">${fmtSimple(v2)}</div></td>
            <td><div class="calc-cell ${prefix}-cell-3">${fmtSimple(v3)}</div></td>
            <td class="custom-col">
                <input type="number" min="0" class="custom-input custom-qty ${prefix}-cust-qty" placeholder="Adet" oninput="calculateAll()">
                <input type="number" min="0" class="custom-input custom-price ${prefix}-cust-price" placeholder="Fiyat" oninput="calcTotalsOnly()">
            </td>
            <td class="row-total ${clsTot}">0 â‚º</td>
            <td class="del-cell" onclick="delRow(this)">Ã—</td>
        </tr>`;
    }

    function createIndividualRow(name, price, target, qtyVal, isChecked) {
        let checkAttr = isChecked ? 'checked' : '';
        return `<tr data-target="${target || 'manual'}" draggable="true">
            <td class="drag-handle">â˜°</td>
            <td><input type="checkbox" class="row-select" ${checkAttr} onchange="handleCheck(this, 'individual')"></td>
            <td><input class="inp-flat" value="${name}" placeholder="ÃœrÃ¼n AdÄ±" oninput="saveToLocal()"></td>
            <td><input type="number" min="0" class="price-input ind-price" value="${price}" oninput="calculateAll()"></td>
            <td class="row-total ind-total">0 â‚º</td>
            <td class="del-cell" onclick="delRow(this)">Ã—</td>
        </tr>`;
    }

    function createSimpleRow(type, name, price, qtyVal, isChecked) {
        let checkAttr = isChecked ? 'checked' : '';
        let isPreschoolBox = (type === 'preschoolBoxes');
        let isPlusService = (type === 'plusServices');
        
        // Plus Hizmet ise adet kilitli (Otomatik Toplam Ã–ÄŸrenci), diÄŸerleri (Kutular & Setler) serbest manuel
        let qtyAttr = isPlusService ? 'readonly style="background:#eee;"' : '';
        
        return `<tr draggable="true" data-simple-type="${type}">
            <td class="drag-handle">â˜°</td>
            <td><input type="checkbox" class="row-select" ${checkAttr} onchange="calculateAll()"></td>
            <td><input class="inp-flat" value="${name}" placeholder="ÃœrÃ¼n AdÄ±" oninput="saveToLocal()"></td>
            <td><input type="number" min="0" class="price-input simple-price" value="${price}" oninput="calculateAll()"></td>
            <td>
                <input type="number" min="0" class="qty-input simple-qty" value="${qtyVal}" ${qtyAttr} oninput="calculateAll()">
            </td>
            <td class="row-total simple-total">0 â‚º</td>
            <td class="del-cell" onclick="delRow(this)">Ã—</td>
        </tr>`;
    }

    function updateRowLevel(sel) {
        let row = sel.closest('tr');
        row.setAttribute('data-level', sel.value);
        calculateAll();
    }

    function updateRowPrices(refInput, type) {
        let row = refInput.closest('tr');
        if(refInput.value < 0) refInput.value = 0;
        let newPrice = parseFloat(refInput.value) || 0;
        let multipliers = type === 'projects' ? configProjects.multipliers : configMaterials.multipliers;
        let prefix = type === 'projects' ? 'p' : 'm';
        row.querySelector(`.${prefix}-cell-0`).innerText = fmtSimple(newPrice * multipliers[0]);
        row.querySelector(`.${prefix}-cell-1`).innerText = fmtSimple(newPrice * multipliers[1]);
        row.querySelector(`.${prefix}-cell-2`).innerText = fmtSimple(newPrice * multipliers[2]);
        row.querySelector(`.${prefix}-cell-3`).innerText = fmtSimple(newPrice * multipliers[3]);
        calculateAll();
    }

    function initDragAndDrop() {
        const lists = document.querySelectorAll('.sortable-list');
        lists.forEach(list => {
            list.addEventListener('dragstart', (e) => { if(e.target.tagName === 'TR') e.target.classList.add('dragging'); });
            list.addEventListener('dragend', (e) => { 
                if(e.target.tagName === 'TR') {
                    e.target.classList.remove('dragging'); 
                    saveToLocal(); 
                }
            });
            list.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(list, e.clientY);
                const draggable = document.querySelector('.dragging');
                if (afterElement == null) list.appendChild(draggable); else list.insertBefore(draggable, afterElement);
            });
        });
    }

    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('tr:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) return { offset: offset, element: child }; else return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function addNewRow(type) {
        let containerId, rowHtml;
        if (type === 'projects') {
            containerId = 'bodyProjects';
            rowHtml = createMatrixRow('projects', '', 0, 'all', true);
        } else if (type === 'materials') {
            containerId = 'bodyMaterials';
            rowHtml = createMatrixRow('materials', '', 0, 'all', true);
        } else if (type === 'individual') {
            containerId = 'bodyIndividual';
            rowHtml = createIndividualRow('', 0, 'manual', 0, true);
        } else if (type === 'experimentSets') {
            containerId = 'bodyExperimentSets';
            rowHtml = createSimpleRow('experimentSets', '', 0, 0, true); // VarsayÄ±lan adet 0
        } else if (type === 'preschoolBoxes') {
            containerId = 'bodyPreschoolBoxes';
            rowHtml = createSimpleRow('preschoolBoxes', '', 0, 0, true); // VarsayÄ±lan adet 0
        } else if (type === 'plusServices') {
            containerId = 'bodyPlusServices';
            rowHtml = createSimpleRow('plusServices', 'Ek Master Hizmet', 0, 0, true);
        }
        document.getElementById(containerId).insertAdjacentHTML('beforeend', rowHtml);
        calculateAll(true);
    }

    function delRow(btn) { 
        btn.closest('tr').remove(); 
        calculateAll(); 
    }

    function handleCheck(checkbox, type) {
        if(!checkbox.checked) {
            calculateAll();
            return;
        }

        if(type === 'projects') {
            const checkedCount = document.querySelectorAll('#bodyProjects .row-select:checked').length;
            if(checkedCount > 6) {
                checkbox.checked = false;
                alert("Lab Proje bÃ¶lÃ¼mÃ¼nden en fazla 6 adet seÃ§ebilirsiniz.");
                return;
            }
        } 
        else if (type === 'individual') {
            let row = checkbox.closest('tr');
            let target = row.getAttribute('data-target');
            if(target && target.startsWith('s')) {
                let limit = 0;
                if(target === 's1' || target === 's2') limit = 4;
                else if(target === 's3' || target === 's4') limit = 3;

                if(limit > 0) {
                    let count = 0;
                    document.querySelectorAll('#bodyIndividual tr').forEach(r => {
                        if(r.querySelector('.row-select').checked && r.getAttribute('data-target') === target) {
                            count++;
                        }
                    });
                    if(count > limit) {
                        checkbox.checked = false;
                        alert(target + ". sÄ±nÄ±f seviyesi iÃ§in en fazla " + limit + " adet Ã¼rÃ¼n seÃ§ebilirsiniz.");
                        return;
                    }
                }
            }
        }
        calculateAll();
    }

    function calculateAll(forceUpdate = false) {
        counts = { s0:0, s1:0, s2:0, s3:0, s4:0, s5:0, s6:0, s7:0, s8:0, s9:0, s10:0, s11:0, s12:0 };
        const ids = Object.keys(counts);
        let totalAll = 0;
        
        ids.forEach(id => {
            let el = document.getElementById(id);
            if(el.value < 0) el.value = 0;
            let val = parseInt(el.value) || 0;
            counts[id] = val;
            totalAll += val;
        });

        let subPre = counts['s0'];
        let subPri = counts['s1'] + counts['s2'] + counts['s3'] + counts['s4'];
        let subMid = counts['s5'] + counts['s6'] + counts['s7'] + counts['s8'];
        let subHig = counts['s9'] + counts['s10'] + counts['s11'] + counts['s12'];

        counts.pre = subPre;
        counts.pri = subPri;
        counts.mid = subMid;
        counts.high = subHig;
        counts.all = totalAll;

        document.getElementById('sub_pre').innerText = subPre;
        document.getElementById('sub_primary').innerText = subPri;
        document.getElementById('sub_middle').innerText = subMid;
        document.getElementById('sub_high').innerText = subHig;
        document.getElementById('lblTotalStudents').innerText = totalAll;

        // PLUS HÄ°ZMET (Otomatik Adet GÃ¼ncelleme)
        document.querySelectorAll('#bodyPlusServices tr').forEach(row => {
            let isChecked = row.querySelector('.row-select').checked;
            if(isChecked) row.querySelector('.simple-qty').value = totalAll;
            else row.querySelector('.simple-qty').value = 0;
        });

        calcTotalsOnly(totalAll);
        saveToLocal(); 
    }

    function calcTotalsOnly(totalStudents = null) {
        if(totalStudents === null) totalStudents = parseInt(document.getElementById("lblTotalStudents").innerText);
        
        let rangeText = "SeÃ§im Yok";
        if(totalStudents > 0) {
            if(totalStudents <= 250) rangeText = "1-250 AralÄ±ÄŸÄ±";
            else if(totalStudents <= 500) rangeText = "251-500 AralÄ±ÄŸÄ±";
            else if(totalStudents <= 1000) rangeText = "501-1000 AralÄ±ÄŸÄ±";
            else rangeText = "1000+ AralÄ±ÄŸÄ±";
        }
        document.getElementById('lblRangeInfo').innerText = rangeText;

        let grandMat = 0;
        let projSubTotal = 0;
        let matSubTotal = 0;

        // --- MATRÄ°S HESAPLAMA ---
        ['bodyProjects', 'bodyMaterials'].forEach(bodyId => {
            let type = bodyId === 'bodyProjects' ? 'projects' : 'materials';
            let prefix = type === 'projects' ? 'p' : 'm';
            let totalClass = type === 'projects' ? '.proj-total' : '.mat-total';
            let multipliers = type === 'projects' ? configProjects.multipliers : configMaterials.multipliers;

            document.querySelectorAll(`#${bodyId} tr`).forEach((row, i) => {
                let isChecked = row.querySelector('.row-select').checked;
                if(!isChecked) {
                    row.classList.add('row-disabled');
                    row.classList.remove('row-manual-active');
                    row.querySelector(totalClass).innerText = fmt(0);
                    row.querySelectorAll('.calc-cell').forEach(c => c.classList.remove('active-cell'));
                    return;
                }
                row.classList.remove('row-disabled');

                let custQty = parseFloat(row.querySelector(`.${prefix}-cust-qty`).value);
                let custPrice = parseFloat(row.querySelector(`.${prefix}-cust-price`).value);
                let tot = 0;

                if(!isNaN(custQty) && !isNaN(custPrice) && custQty > 0) {
                    if(custQty < 0) custQty = 0;
                    if(custPrice < 0) custPrice = 0;
                    tot = custQty * custPrice;
                    row.classList.add('row-manual-active');
                    row.querySelector(totalClass).style.color = "#dc3545";
                    row.querySelectorAll('.calc-cell').forEach(c => c.classList.remove('active-cell'));
                } else {
                    row.classList.remove('row-manual-active');
                    let level = row.getAttribute('data-level'); 
                    let relevantCount = counts[level] || 0; 
                    let refPrice = parseFloat(row.querySelector('.ref-price').value) || 0;
                    let activeIdx = -1;
                    if (relevantCount > 0) {
                        activeIdx = 0; 
                        if (relevantCount > 1000) activeIdx = 3;
                        else if (relevantCount > 500) activeIdx = 2;
                        else if (relevantCount > 250) activeIdx = 1;
                    }
                    row.querySelectorAll('.calc-cell').forEach(c => c.classList.remove('active-cell'));
                    if (activeIdx !== -1) {
                        let multiplier = multipliers[activeIdx];
                        tot = refPrice * multiplier;
                        row.querySelector(`.${prefix}-cell-${activeIdx}`).classList.add('active-cell');
                    } else { tot = 0; }
                    row.querySelector(totalClass).style.color = "var(--primary)";
                }
                
                row.querySelector(totalClass).innerText = fmt(tot);
                if(type === 'projects') projSubTotal += tot; else matSubTotal += tot;
            });
        });

        // --- BÄ°REYSEL HESAPLAMA ---
        let indSubTotal = 0;
        document.querySelectorAll('#bodyIndividual tr').forEach(row => {
            let isChecked = row.querySelector('.row-select').checked;
            if(!isChecked) {
                row.classList.add('row-disabled');
                row.querySelector('.ind-total').innerText = fmt(0);
                return;
            }
            row.classList.remove('row-disabled');
            let pInput = row.querySelector('.ind-price');
            if(pInput.value < 0) pInput.value = 0;
            let price = parseFloat(pInput.value) || 0;
            
            // Adet Otomatik (Target SÄ±nÄ±fÄ±n Ã–ÄŸrenci SayÄ±sÄ±)
            let target = row.getAttribute('data-target');
            let qty = 0;
            if(target && counts[target] !== undefined) {
                qty = counts[target];
            }
            
            let tot = price * qty;
            row.querySelector('.ind-total').innerText = fmt(tot);
            indSubTotal += tot;
        });

        // --- SET HESAPLAMA (DÃœZELTÄ°LDÄ°: Kendi Adet ToplamÄ±na BÃ¶lÃ¼necek) ---
        let expSubTotal = 0;
        let expTotalQty = 0; // Yeni: Sadece bu bÃ¶lÃ¼mdeki adetlerin toplamÄ±
        document.querySelectorAll('#bodyExperimentSets tr').forEach(row => {
            let isChecked = row.querySelector('.row-select').checked;
            if(!isChecked) { row.classList.add('row-disabled'); row.querySelector('.simple-total').innerText = fmt(0); return; }
            row.classList.remove('row-disabled');
            let price = parseFloat(row.querySelector('.simple-price').value) || 0;
            let qty = parseInt(row.querySelector('.simple-qty').value) || 0;
            let tot = price * qty;
            row.querySelector('.simple-total').innerText = fmt(tot);
            expSubTotal += tot;
            expTotalQty += qty; // Adeti topla
        });

        // --- KUTU HESAPLAMA (DÃœZELTÄ°LDÄ°: Kendi Adet ToplamÄ±na BÃ¶lÃ¼necek) ---
        let preBoxSubTotal = 0;
        let preBoxTotalQty = 0; // Yeni: Sadece bu bÃ¶lÃ¼mdeki adetlerin toplamÄ±
        document.querySelectorAll('#bodyPreschoolBoxes tr').forEach(row => {
            let isChecked = row.querySelector('.row-select').checked;
            if(!isChecked) { row.classList.add('row-disabled'); row.querySelector('.simple-total').innerText = fmt(0); return; }
            row.classList.remove('row-disabled');
            let price = parseFloat(row.querySelector('.simple-price').value) || 0;
            let qty = parseInt(row.querySelector('.simple-qty').value) || 0; 
            let tot = price * qty;
            row.querySelector('.simple-total').innerText = fmt(tot);
            preBoxSubTotal += tot;
            preBoxTotalQty += qty; // Adeti topla
        });

        // --- PLUS HÄ°ZMET (DÃœZELTÄ°LDÄ°: Kendi Adet ToplamÄ±na BÃ¶lÃ¼necek) ---
        let plusServicesTotal = 0; 
        let plusServicesQty = 0;
        document.querySelectorAll('#bodyPlusServices tr').forEach(row => {
            let isChecked = row.querySelector('.row-select').checked;
            if(!isChecked) { row.classList.add('row-disabled'); row.querySelector('.simple-total').innerText = fmt(0); return; }
            row.classList.remove('row-disabled');
            let price = parseFloat(row.querySelector('.simple-price').value) || 0;
            let qty = totalStudents; // Burada adet = toplam Ã¶ÄŸrenci
            row.querySelector('.simple-qty').value = qty;
            let tot = price * qty;
            row.querySelector('.simple-total').innerText = fmt(tot);
            plusServicesTotal += tot;
            plusServicesQty += qty;
        });

        // EKRANA YAZDIRMA (TOPLAMLAR VE DÃœZELTÄ°LMÄ°Å ORTALAMALAR)
        document.getElementById('sum_projects').innerText = fmt(projSubTotal);
        document.getElementById('avg_projects').innerText = totalStudents > 0 ? fmt(projSubTotal/totalStudents) : "0 â‚º";
        
        document.getElementById('sum_materials').innerText = fmt(matSubTotal);
        document.getElementById('avg_materials').innerText = totalStudents > 0 ? fmt(matSubTotal/totalStudents) : "0 â‚º";
        
        document.getElementById('sum_individual').innerText = fmt(indSubTotal);
        document.getElementById('avg_individual').innerText = totalStudents > 0 ? fmt(indSubTotal/totalStudents) : "0 â‚º";

        // YENÄ° MANTIK: Setler ToplamÄ± / Setlerde Girilen Toplam Adet
        document.getElementById('sum_experiments').innerText = fmt(expSubTotal);
        document.getElementById('avg_experiments').innerText = expTotalQty > 0 ? fmt(expSubTotal / expTotalQty) : "0 â‚º";

        // YENÄ° MANTIK: Kutular ToplamÄ± / Kutularda Girilen Toplam Adet
        document.getElementById('sum_preschool').innerText = fmt(preBoxSubTotal);
        document.getElementById('avg_preschool').innerText = preBoxTotalQty > 0 ? fmt(preBoxSubTotal / preBoxTotalQty) : "0 â‚º";

        // YENÄ° MANTIK: Plus Toplam / Plus Girilen Adet (Zaten TotalStudent)
        document.getElementById('sum_plus').innerText = fmt(plusServicesTotal); 
        document.getElementById('avg_plus').innerText = plusServicesQty > 0 ? fmt(plusServicesTotal / plusServicesQty) : "0 â‚º";

        grandMat = projSubTotal + matSubTotal + indSubTotal;
        document.getElementById("valMaterial").innerText = fmt(grandMat);

        let perStudentCost = totalStudents > 0 ? (grandMat / totalStudents) : 0;
        
        // Plus Hizmetin maliyete etkisi (Ã–ÄŸrenci baÅŸÄ±na dÃ¼ÅŸen pay)
        // Burada Plus Hizmet zaten "Ã–ÄŸrenci BaÅŸÄ± Fiyat" Ã¼zerinden hesaplandÄ±ÄŸÄ± iÃ§in direkt ortalamayÄ± ekleyebiliriz.
        let plusPerStudent = plusServicesQty > 0 ? (plusServicesTotal / plusServicesQty) : 0;

        document.getElementById("valTekno").innerText = fmt(perStudentCost + 399);
        document.getElementById("valMaster").innerText = fmt(perStudentCost + 1050 + plusPerStudent);
        let extraTotal = expSubTotal + preBoxSubTotal;
        document.getElementById("valExtraTotal").innerText = fmt(extraTotal);
    }

    function fmt(n) { return n.toLocaleString('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + ' â‚º'; }
    function fmtSimple(n) { return n.toLocaleString('tr-TR') + ' â‚º'; } 
</script>

</body>
</html>